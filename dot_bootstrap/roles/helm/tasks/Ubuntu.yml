---
- name: Helm | Install prerequisites
  ansible.builtin.apt:
    name:
      - curl
      - gpg
      - apt-transport-https
    state: present
  become: true

- name: Helm | Add Helm GPG key
  ansible.builtin.shell: >
    curl -fsSL https://packages.buildkite.com/helm-linux/helm-debian/gpgkey
    | gpg --dearmor
    | tee /usr/share/keyrings/helm.gpg > /dev/null
  args:
    creates: /usr/share/keyrings/helm.gpg
  become: true

- name: Helm | Add Helm APT repository
  ansible.builtin.apt_repository:
    repo: "deb [signed-by=/usr/share/keyrings/helm.gpg] https://packages.buildkite.com/helm-linux/helm-debian/any/ any main"
    filename: helm-stable-debian
  become: true

- name: Helm | Update APT cache
  ansible.builtin.apt:
    update_cache: true
  become: true

- name: Helm | Install Helm
  ansible.builtin.apt:
    name: helm
    state: present
  become: true
