---
- name: "ghostty | {{ ansible_facts['distribution'] }} | Install build dependencies"
  ansible.builtin.dnf:
    name:
      - gtk4-devel
      - libadwaita-devel
      - git
    state: present
  become: true

- name: "ghostty | {{ ansible_facts['distribution'] }} | Check if ghostty is installed"
  ansible.builtin.stat:
    path: /usr/local/bin/ghostty
  register: ghostty_installed

- name: "ghostty | {{ ansible_facts['distribution'] }} | Clone ghostty"
  ansible.builtin.git:
    repo: https://github.com/ghostty-org/ghostty.git
    dest: /tmp/ghostty
    depth: 1
  become: false
  when: not ghostty_installed.stat.exists

- name: "ghostty | {{ ansible_facts['distribution'] }} | Build and install ghostty"
  ansible.builtin.shell: |
    cd /tmp/ghostty
    zig build -p /usr/local -Doptimize=ReleaseFast
  become: true
  when: not ghostty_installed.stat.exists
